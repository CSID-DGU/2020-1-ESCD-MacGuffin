{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nrequire(\"proxy-polyfill\");\n\nvar utils_1 = require(\"./utils\");\n\nvar PENDING = utils_1.actionTypes.PENDING,\n    SUCCESS = utils_1.actionTypes.SUCCESS,\n    FAILURE = utils_1.actionTypes.FAILURE,\n    CANCEL = utils_1.actionTypes.CANCEL;\nvar _id = 0;\n\nfunction generatePenderId() {\n  _id += 1;\n  return _id;\n}\n\nfunction isPromise(promise) {\n  if (!promise) return false;\n  return promise.then && promise.catch;\n}\n\nfunction getPromise(action, major) {\n  var payload = action.payload;\n  if (!payload) return null;\n\n  if (major) {\n    if (isPromise(payload)) return payload;\n  }\n\n  var pend = action.payload.pend;\n  if (isPromise(pend)) return pend;\n  return null;\n}\n\nfunction penderMiddleware(config) {\n  if (config === void 0) {\n    config = {\n      major: true,\n      raw: false\n    };\n  }\n\n  var major = config.major === undefined ? true : config.major;\n  return function (store) {\n    return function (next) {\n      return function (action) {\n        // retrieve Promise if possible\n        var promise = getPromise(action, major);\n        if (!promise) return next(action); // skip if no promise found\n\n        var type = action.type,\n            meta = action.meta;\n        var actions = utils_1.penderize(type);\n        var cancelled = false; // promise start\n\n        store.dispatch({\n          type: actions.PENDING,\n          meta: meta\n        }); // inform pender reducer\n\n        store.dispatch({\n          type: PENDING,\n          payload: type\n        }); // use proxy to handle promise cancellation\n\n        var origin = {\n          cancel: false,\n          resolve: false\n        };\n        var proxy = null;\n        var cancelPromise = new Promise(function (resolve, reject) {\n          var handler = {\n            set: function (target, key, value) {\n              if (key === 'cancel') {\n                cancelled = true;\n                store.dispatch({\n                  type: CANCEL,\n                  payload: type\n                });\n                store.dispatch({\n                  type: actions.CANCEL,\n                  meta: meta\n                });\n                reject(new Error(type + \" is cancelled\"));\n                proxy = null;\n                return true;\n              }\n\n              if (key === 'resolve') {\n                resolve();\n                return true;\n              }\n\n              return true;\n            }\n          };\n          proxy = new Proxy(origin, handler);\n        });\n\n        var cancel = function () {\n          if (!proxy) return;\n          proxy.cancel = true;\n        };\n\n        promise.then(function (result) {\n          if (cancelled) return; // do nothing if cancelled\n\n          if (!proxy) return;\n          proxy.resolve = true;\n          proxy = null; // promise resolved\n\n          store.dispatch({\n            type: actions.SUCCESS,\n            payload: result,\n            meta: meta\n          }); // inform pender reducer\n\n          store.dispatch({\n            type: SUCCESS,\n            payload: type\n          });\n        }).catch(function (e) {\n          if (cancelled) return; // do nothing if cancelled\n\n          if (!proxy) return;\n          proxy.resolve = true;\n          proxy = null; // promise rejected\n\n          store.dispatch({\n            type: actions.FAILURE,\n            payload: e,\n            error: true,\n            meta: meta\n          }); // inform pender reducer\n\n          store.dispatch({\n            type: FAILURE,\n            payload: type\n          });\n        });\n        var cancellablePromise = Promise.race([promise, cancelPromise]);\n        cancellablePromise.cancel = cancel;\n\n        if (config.raw) {\n          return {\n            type: type,\n            meta: meta,\n            payload: cancellablePromise\n          };\n        }\n\n        return cancellablePromise;\n      };\n    };\n  };\n}\n\nexports.default = penderMiddleware;","map":{"version":3,"sources":["C:/Users/BumSu Park/React/macguffin/node_modules/redux-pender/lib/middleware.js"],"names":["Object","defineProperty","exports","value","require","utils_1","PENDING","actionTypes","SUCCESS","FAILURE","CANCEL","_id","generatePenderId","isPromise","promise","then","catch","getPromise","action","major","payload","pend","penderMiddleware","config","raw","undefined","store","next","type","meta","actions","penderize","cancelled","dispatch","origin","cancel","resolve","proxy","cancelPromise","Promise","reject","handler","set","target","key","Error","Proxy","result","e","error","cancellablePromise","race","default"],"mappings":"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","sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nrequire(\"proxy-polyfill\");\nvar utils_1 = require(\"./utils\");\nvar PENDING = utils_1.actionTypes.PENDING, SUCCESS = utils_1.actionTypes.SUCCESS, FAILURE = utils_1.actionTypes.FAILURE, CANCEL = utils_1.actionTypes.CANCEL;\nvar _id = 0;\nfunction generatePenderId() {\n    _id += 1;\n    return _id;\n}\nfunction isPromise(promise) {\n    if (!promise)\n        return false;\n    return promise.then && promise.catch;\n}\nfunction getPromise(action, major) {\n    var payload = action.payload;\n    if (!payload)\n        return null;\n    if (major) {\n        if (isPromise(payload))\n            return payload;\n    }\n    var pend = action.payload.pend;\n    if (isPromise(pend))\n        return pend;\n    return null;\n}\nfunction penderMiddleware(config) {\n    if (config === void 0) { config = { major: true, raw: false }; }\n    var major = config.major === undefined ? true : config.major;\n    return function (store) { return function (next) { return function (action) {\n        // retrieve Promise if possible\n        var promise = getPromise(action, major);\n        if (!promise)\n            return next(action); // skip if no promise found\n        var type = action.type, meta = action.meta;\n        var actions = utils_1.penderize(type);\n        var cancelled = false;\n        // promise start\n        store.dispatch({\n            type: actions.PENDING,\n            meta: meta,\n        });\n        // inform pender reducer\n        store.dispatch({\n            type: PENDING,\n            payload: type,\n        });\n        // use proxy to handle promise cancellation\n        var origin = {\n            cancel: false,\n            resolve: false,\n        };\n        var proxy = null;\n        var cancelPromise = new Promise(function (resolve, reject) {\n            var handler = {\n                set: function (target, key, value) {\n                    if (key === 'cancel') {\n                        cancelled = true;\n                        store.dispatch({\n                            type: CANCEL,\n                            payload: type,\n                        });\n                        store.dispatch({\n                            type: actions.CANCEL,\n                            meta: meta,\n                        });\n                        reject(new Error(type + \" is cancelled\"));\n                        proxy = null;\n                        return true;\n                    }\n                    if (key === 'resolve') {\n                        resolve();\n                        return true;\n                    }\n                    return true;\n                },\n            };\n            proxy = new Proxy(origin, handler);\n        });\n        var cancel = function () {\n            if (!proxy)\n                return;\n            proxy.cancel = true;\n        };\n        promise\n            .then(function (result) {\n            if (cancelled)\n                return; // do nothing if cancelled\n            if (!proxy)\n                return;\n            proxy.resolve = true;\n            proxy = null;\n            // promise resolved\n            store.dispatch({\n                type: actions.SUCCESS,\n                payload: result,\n                meta: meta,\n            });\n            // inform pender reducer\n            store.dispatch({\n                type: SUCCESS,\n                payload: type,\n            });\n        })\n            .catch(function (e) {\n            if (cancelled)\n                return; // do nothing if cancelled\n            if (!proxy)\n                return;\n            proxy.resolve = true;\n            proxy = null;\n            // promise rejected\n            store.dispatch({\n                type: actions.FAILURE,\n                payload: e,\n                error: true,\n                meta: meta,\n            });\n            // inform pender reducer\n            store.dispatch({\n                type: FAILURE,\n                payload: type,\n            });\n        });\n        var cancellablePromise = Promise.race([\n            promise,\n            cancelPromise,\n        ]);\n        cancellablePromise.cancel = cancel;\n        if (config.raw) {\n            return {\n                type: type,\n                meta: meta,\n                payload: cancellablePromise,\n            };\n        }\n        return cancellablePromise;\n    }; }; };\n}\nexports.default = penderMiddleware;\n"]},"metadata":{},"sourceType":"script"}